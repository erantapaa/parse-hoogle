-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | convert document IDs such as DOI, ISBN, arXiv ID to bibliographic reference.
--   
--   This modules provides a way to convert document identifiers, such as
--   DOIs, ISBNs, arXiv IDs to bibliographic references.
--   
--   Each type of identifiers will be converted via internet services to a
--   bibliographic record of type <a>Text.CSL.Reference</a> , which in turn
--   can be rendered in various format using <tt>citeproc-hs</tt> package
--   <a>http://hackage.haskell.org/package/citeproc-hs</a> .
--   
--   Moreover, the server responses are cached in a local database, making
--   the server load as little as possible.
@package citation-resolve
@version 0.3.0.3

module Text.CSL.Input.Identifier.Internal

-- | The data structure that carries the resolved references. Since the
--   mapping <tt>Reference -&gt; BibTeX</tt> is not the inverse of
--   <tt>BibTeX -&gt; Reference</tt> for the version
--   <tt>citeproc-hs-0.3.8</tt> and loses some information, we choose to
--   store the original BibTeX string in the DB, rather than
--   <a>Reference</a>.
newtype DB
DB :: Map String String -> DB
unDB :: DB -> Map String String

-- | The lens for accessing the map within the DB.
db :: Simple Iso DB (Map String String)
withDBFile :: (MonadIO m, MonadState DB m) => FilePath -> m a -> m a

-- | Resolver Monad is a function that converts a key of type <tt>a</tt> to
--   some other type <tt>b</tt>, which may fail with an error message.
type RM m a b = a -> EitherT String m b

-- | Perform possibly failing IO within a monad
liftIOE :: MonadIO m => IO (Either a b) -> EitherT a m b

-- | parse a Bibtex entry that contains single reference.
resolveBibtex :: MonadIO m => String -> RM m String Reference

-- | resolve a document url to a <a>Reference</a>, or emits a error message
--   with reason why it fails.
resolveEither :: (MonadIO m, MonadState DB m) => String -> EitherT String m Reference
resolveDOI :: MonadIO m => RM m String String
resolveArXiv :: MonadIO m => RM m String String
resolveBibcode :: MonadIO m => RM m String String
resolveISBN :: MonadIO m => RM m String String

-- | a safer way to get data file name.
getDataFileName :: String -> IO String
instance ToJSON DB
instance FromJSON DB
instance Default DB


-- | This modules provides a way to convert document identifiers, such as
--   DOIs, ISBNs, arXiv IDs to bibliographic references.
--   
--   Each type of identifiers will be converted via internet services to a
--   bibliographic record of type <a>Reference</a> , which in turn can be
--   rendered in various format using <tt>citeproc-hs</tt> package
--   <a>hackage.haskell.org/package/citeproc-hs</a> .
--   
--   Moreover, the server responses are cached in a local database, making
--   the server load as little as possible.
module Text.CSL.Input.Identifier

-- | resolve a document url to a <a>Reference</a>, or emits a error message
--   with reason why it fails.
resolveEither :: (MonadIO m, MonadState DB m) => String -> EitherT String m Reference

-- | Resolve a document url to a <a>Reference</a>. returns an empty
--   reference when someting fails. prefix the document ID with one of
--   <a>arXiv:</a>, <a>doi:</a>, <a>bibcode:</a> or <a>isbn:</a> .
--   
--   <pre>
--   &gt;&gt;&gt; do { ref &lt;- resolveDef "arXiv:1204.4779" ; putStrLn $ title ref }
--   Paraiso: an automated tuning framework for explicit solvers of partial differential equations
--   
--   &gt;&gt;&gt; do { ref &lt;- resolveDef "doi:10.1088/1749-4699/5/1/015003" ; print $ author ref }
--   [Takayuki Muranushi]
--   
--   &gt;&gt;&gt; do { ref &lt;- resolveDef "bibcode:2012CS&amp;D....5a5003M" ; putStrLn $ containerTitle ref }
--   Computational Science and Discovery
--   
--   &gt;&gt;&gt; do { ref &lt;- resolveDef "isbn:9784274068850" ; putStrLn $ title ref }
--   Sugoi hasukeru tanoshiku manab≈ç
--   </pre>
resolve :: (MonadIO m, MonadState DB m) => String -> m Reference
withDBFile :: (MonadIO m, MonadState DB m) => FilePath -> m a -> m a

-- | The data structure that carries the resolved references. Since the
--   mapping <tt>Reference -&gt; BibTeX</tt> is not the inverse of
--   <tt>BibTeX -&gt; Reference</tt> for the version
--   <tt>citeproc-hs-0.3.8</tt> and loses some information, we choose to
--   store the original BibTeX string in the DB, rather than
--   <a>Reference</a>.
newtype DB
DB :: Map String String -> DB
unDB :: DB -> Map String String

-- | The lens for accessing the map within the DB.
db :: Simple Iso DB (Map String String)
