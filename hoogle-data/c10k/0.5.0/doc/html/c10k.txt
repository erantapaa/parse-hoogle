-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | C10k server library using prefork
--   
--   Network server library to handle over 10,000 connections. Since GHC
--   6.12 or earlier uses select(), it cannot handle connections over
--   1,024. This library uses the prefork technique to get over the
--   barrier. Programs complied by GHC 6.10 or earlier with the -threaded
--   option kill the IO thread when forkProcess is used. So, don't specify
--   the -threaded option to use this library.
@package c10k
@version 0.5.0


-- | Yet another accept() to tell TCP information.
module Network.TCPInfo

-- | A Type to carry TCP information.
data TCPInfo
TCPInfo :: HostName -> ServiceName -> HostName -> ServiceName -> TCPInfo

-- | Local IP address
myAddr :: TCPInfo -> HostName

-- | Local port number
myPort :: TCPInfo -> ServiceName

-- | Remote IP address
peerAddr :: TCPInfo -> HostName

-- | Remote port number
peerPort :: TCPInfo -> ServiceName

-- | Yet another accept() to return both <a>Handle</a> and <a>TCPInfo</a>.
accept :: Socket -> IO (Handle, TCPInfo)
instance Eq TCPInfo
instance Show TCPInfo


-- | Network server library to handle over 10,000 connections. Since GHC
--   6.12 or earlier uses select(), it cannot handle connections over
--   1,024. This library uses the "prefork" technique to get over the
--   barrier. Each process handles <a>threadNumberPerProcess</a>
--   connections. <a>preforkProcessNumber</a> child server processes are
--   preforked. So, this server can handle <a>preforkProcessNumber</a> *
--   <a>threadNumberPerProcess</a> connections.
--   
--   GHC 7 supports kqueue or epoll() but it is difficult to balance over
--   multi-core. So, this library can be used to make a process for each
--   core and to set limitation of the number to accept connections.
--   
--   To stop all server, send SIGTERM to the parent process. (e.g. <tt>kill
--   `cat PIDFILE`</tt> where the PID file name is specified by
--   <a>pidFile</a>)
module Network.C10kServer

-- | The type of configuration given to <a>runC10kServer</a> as the second
--   argument.
data C10kConfig
C10kConfig :: IO () -> (String -> IO ()) -> IO () -> IO () -> Int -> Int -> Int -> ServiceName -> Maybe HostName -> FilePath -> String -> String -> C10kConfig

-- | A hook called initialization time. This is used topically to
--   initialize syslog.
initHook :: C10kConfig -> IO ()

-- | A hook called when the server exits due to an error.
exitHook :: C10kConfig -> String -> IO ()

-- | A hook to be called in the parent process when all child process are
--   preforked successfully.
parentStartedHook :: C10kConfig -> IO ()

-- | A hook to be called when each child process is started successfully.
startedHook :: C10kConfig -> IO ()

-- | The time in seconds that a main thread of each child process to sleep
--   when the number of connection reaches <a>threadNumberPerProcess</a>.
sleepTimer :: C10kConfig -> Int

-- | The number of child process.
preforkProcessNumber :: C10kConfig -> Int

-- | The number of thread which a process handle.
threadNumberPerProcess :: C10kConfig -> Int

-- | A port name. e.g. "http" or "80"
portName :: C10kConfig -> ServiceName

-- | A numeric IP address. e.g. "127.0.0.1"
ipAddr :: C10kConfig -> Maybe HostName

-- | A file where the process ID of the parent process is written.
pidFile :: C10kConfig -> FilePath

-- | A user name. When the program linked with this library runs in the
--   root privilege, set user to this value. Otherwise, this value is
--   ignored.
user :: C10kConfig -> String

-- | A group name. When the program linked with this library runs in the
--   root privilege, set group to this value. Otherwise, this value is
--   ignored.
group :: C10kConfig -> String

-- | The type of the first argument of <a>runC10kServer</a>.
type C10kServer = Socket -> IO ()

-- | Run <a>C10kServer</a> with <a>C10kConfig</a>.
runC10kServer :: C10kServer -> C10kConfig -> IO ()

-- | The type of the first argument of <a>runC10kServerH</a>.
type C10kServerH = Handle -> TCPInfo -> IO ()

-- | Run <a>C10kServerH</a> with <a>C10kConfig</a>.
runC10kServerH :: C10kServerH -> C10kConfig -> IO ()
