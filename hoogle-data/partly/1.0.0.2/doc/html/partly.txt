-- Hoogle documentation, generated by Haddock
-- See Hoogle, http://www.haskell.org/hoogle/


-- | Inspect, create, and alter MBRs.
--   
--   A Haskell library and command-line tool to create, inspect, and alter
--   master boot records.
@package partly
@version 1.0.0.2


-- | Types for dealing with the old-fasioned and modern Master Boot
--   Records. This does not cover things like the GUID partition table or
--   any of the weird variations like AAP or NEWLDR.
module System.Disk.Partitions.MBR

-- | The so-called mystery bytes on Windows 95B, 98, 98SE, and Me -- in
--   fact, they're a timestamp and a drive number. See
--   http:<i></i>thestarman.pcministry.com<i>asm</i>mbr/mystery.htm .
data Timestamp
Timestamp :: Word8 -> Word8 -> Word8 -> Word8 -> Timestamp
physicalDrive :: Timestamp -> Word8
seconds :: Timestamp -> Word8
minutes :: Timestamp -> Word8
hours :: Timestamp -> Word8

-- | A representation of the cylinder<i>head</i>sector address in MBRs.
data CHS
CHS :: Word8 -> Word8 -> Word16 -> CHS

-- | The head number.
head :: CHS -> Word8

-- | The sector number; this is actually a six-bit number, but Haskell
--   doesn't have a convenient way to deal with those.
sector :: CHS -> Word8

-- | The cylinder number; likewise, this is actually a 10-bit number.
cylinder :: CHS -> Word16

-- | Partition entries themselves are somewhat intricate.
data PartitionEntry
PartitionEntry :: Word8 -> CHS -> Word8 -> CHS -> Word32 -> Word32 -> PartitionEntry

-- | A bitfield describing this partition. An 0x00 here means it's
--   inactive; having bit 7 set (i.e. &gt; 0x80) means bootable; anything
--   less is invalid.
status :: PartitionEntry -> Word8

-- | The CHS address of the first absolute sector of the partition.
chsFirst :: PartitionEntry -> CHS

-- | A partition type; for specifics, see the following document:
--   http:<i></i>www.win.tue.nl<i>~aeb</i>partitions/partition_types-1.html
partitionType :: PartitionEntry -> Word8

-- | The CHS address of the last absolute sector of the partition.
chsLast :: PartitionEntry -> CHS

-- | The logical block address of the first absolute sector.
lbaFirst :: PartitionEntry -> Word32

-- | The number of sectors in the partition.
sectors :: PartitionEntry -> Word32

-- | The empty partition table entry.
nullPartition :: PartitionEntry

-- | Whether this partition entry is marked bootable.
bootable :: PartitionEntry -> Bool

-- | An MBR partition table consists of (up to?) four partition entries.
data PartitionTable
PartitionTable :: PartitionEntry -> PartitionEntry -> PartitionEntry -> PartitionEntry -> PartitionTable
first :: PartitionTable -> PartitionEntry
second :: PartitionTable -> PartitionEntry
third :: PartitionTable -> PartitionEntry
fourth :: PartitionTable -> PartitionEntry

-- | The empty partition table.
nullPartitionTable :: PartitionTable

-- | The structure of a Master Boot Record is as follows...
data BootRecord
BootRecord :: ByteString -> PartitionTable -> Word16 -> BootRecord

-- | The first piece of data on a disk with a Master Boot Record is some
--   bootloader code that gets loaded to address 0x7c00 in memory. N.B:
--   this may include the data for the Windows timestamp, if it exists. It
--   will also include the optional disk signature, if it exists -- thus
--   this field is always 446 bytes long.
bootloader :: BootRecord -> ByteString

-- | Four partition table entries.
partitions :: BootRecord -> PartitionTable

-- | Finally, the boot signature.
bootSig :: BootRecord -> Word16

-- | The empty bootloader -- 446 empty bytes.
emptyBootloader :: ByteString

-- | The empty boot record.
nullBootRecord :: BootRecord

-- | Get the completely-optional, obsolete disk timestamp used by some old
--   versions of Windows.
getTimestamp :: BootRecord -> Maybe Timestamp

-- | Get the optional disk signature from a Bootrecord's bootloader.
getDiskSignature :: BootRecord -> Maybe Word32
instance Eq Timestamp
instance Show Timestamp
instance Eq CHS
instance Show CHS
instance Eq PartitionEntry
instance Show PartitionEntry
instance Eq PartitionTable
instance Show PartitionTable
instance Eq BootRecord
instance Show BootRecord
instance Binary BootRecord
instance Binary PartitionTable
instance Binary PartitionEntry
instance Binary CHS
instance Binary Timestamp
